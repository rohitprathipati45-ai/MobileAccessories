<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MobileAccessories — Products</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --accent:#0ea5e9; }
    .card { transition: transform .16s ease, box-shadow .16s ease; }
    .card:hover{ transform: translateY(-6px); box-shadow: 0 18px 40px rgba(2,6,23,0.06); }
    .modal-backdrop{ position:fixed; inset:0; background:rgba(2,6,23,0.5); display:flex; align-items:center; justify-content:center; z-index:60; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-white border-b sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <a href="index.html" class="font-bold">← Home</a>
        <input id="q" placeholder="Search products..." class="border rounded px-3 py-2 w-64"/>
      </div>
      <div class="flex items-center gap-3">
        <select id="cat" class="border rounded p-2">
          <option value="all">All categories</option>
          <option value="chargers">Chargers</option>
          <option value="cases">Cases</option>
          <option value="earphones">Earphones</option>
          <option value="cables">Cables</option>
          <option value="powerbanks">Powerbanks</option>
        </select>
        <select id="sort" class="border rounded p-2">
          <option value="popular">Popular</option>
          <option value="low">Price: Low → High</option>
          <option value="high">Price: High → Low</option>
        </select>
        <a href="payment.html" id="cartLink" class="bg-[#111827] text-white px-3 py-2 rounded">Checkout</a>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <aside class="lg:col-span-1 bg-white p-4 rounded-xl shadow">
        <h4 class="font-semibold mb-2">Filters</h4>
        <label class="block text-sm text-gray-600">Price</label>
        <div class="mt-2 flex gap-2">
          <input id="minP" type="number" placeholder="Min" class="border rounded p-2 w-1/2"/>
          <input id="maxP" type="number" placeholder="Max" class="border rounded p-2 w-1/2"/>
        </div>
        <button id="applyFilters" class="mt-3 px-3 py-2 bg-[#0ea5e9] text-white rounded">Apply</button>
      </aside>

      <section class="lg:col-span-3">
        <div class="mb-4 flex items-center justify-between">
          <h2 class="text-2xl font-bold">Products</h2>
          <div class="text-sm text-gray-600" id="resultsInfo"></div>
        </div>

        <div id="list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
      </section>
    </div>
  </main>

  <!-- modal mount -->
  <div id="modalRoot"></div>

  <script>
    // catalog
    const PRODUCTS = [
      { id:1, title:'65W USB-C Charger', price:29.99, category:'chargers', img:'https://images.unsplash.com/photo-1585386959984-a4155224a6ee?q=80&w=800&auto=format&fit=crop', rating:4.6, description:'GaN fast charger, compact and efficient.' },
      { id:2, title:'Clear Shockproof Case', price:12.49, category:'cases', img:'https://images.unsplash.com/photo-1585386959984-a4155224a6ee?q=80&w=800&auto=format&fit=crop', rating:4.3, description:'TPU case with reinforced corners.' },
      { id:3, title:'Wireless Earbuds V2', price:59.00, category:'earphones', img:'https://images.unsplash.com/photo-1512496015851-a90fb38ba796?q=80&w=800&auto=format&fit=crop', rating:4.7, description:'Noise cancellation, 30H battery.' },
      { id:4, title:'Braided Lightning Cable', price:7.99, category:'cables', img:'https://images.unsplash.com/photo-1545239351-1141bd82e8a6?q=80&w=800&auto=format&fit=crop', rating:4.4, description:'Durable tangle-free braided cable.' },
      { id:5, title:'10,000mAh Powerbank', price:24.95, category:'powerbanks', img:'https://images.unsplash.com/photo-1580894908360-7aa4f9a2f1d0?q=80&w=800&auto=format&fit=crop', rating:4.5, description:'Slim powerbank with fast-charge output.' },
      { id:6, title:'Magnetic Car Mount', price:15.50, category:'stands', img:'https://images.unsplash.com/photo-1592891720276-b3b2c02a3d6d?q=80&w=800&auto=format&fit=crop', rating:4.1, description:'Strong magnet, secure hold.' }
    ];

    function inr(v){ return '₹' + Number(v).toFixed(0); }

    // render
    const list = document.getElementById('list');
    const resultsInfo = document.getElementById('resultsInfo');
    function render(items){
      list.innerHTML = '';
      if(items.length === 0){
        list.innerHTML = '<div class="col-span-3 text-gray-600">No products found.</div>';
      } else {
        items.forEach(p=>{
          const node = document.createElement('div');
          node.className = 'bg-white p-4 rounded-xl card';
          node.innerHTML = `
            <div class="cursor-pointer productCard" data-id="${p.id}">
              <div class="w-full h-44 bg-gray-100 rounded overflow-hidden">
                <img src="${p.img}" class="w-full h-full object-cover">
              </div>
              <div class="mt-3">
                <div class="font-medium">${p.title}</div>
                <div class="text-sm text-gray-500 mt-1">${p.rating} ★ • ${p.category}</div>
                <div class="mt-3 flex items-center justify-between">
                  <div class="font-semibold">${inr(p.price*82)}</div>
                  <div class="flex gap-2">
                    <button class="addCart px-3 py-1 bg-[#0ea5e9] text-white rounded" data-id="${p.id}">Add</button>
                    <button class="buyNow px-3 py-1 border rounded" data-id="${p.id}">Buy</button>
                  </div>
                </div>
              </div>
            </div>
          `;
          list.appendChild(node);
        });
      }
      resultsInfo.textContent = `${items.length} results`;
      attachHandlers();
    }

    // filters and sort
    const cat = document.getElementById('cat'), qInput = document.getElementById('q'), sortSel = document.getElementById('sort');
    const minP = document.getElementById('minP'), maxP = document.getElementById('maxP'), applyBtn = document.getElementById('applyFilters');

    function getFiltered(){
      let items = [...PRODUCTS];
      const catv = cat.value;
      const q = (new URLSearchParams(location.search).get('q') || '').toLowerCase() || qInput.value.toLowerCase().trim();
      if(catv !== 'all') items = items.filter(p=> p.category === catv);
      if(q) items = items.filter(p=> p.title.toLowerCase().includes(q) || p.description.toLowerCase().includes(q));
      const min = Number(minP.value) || 0, max = Number(maxP.value) || Infinity;
      items = items.filter(p => (p.price*82) >= min && (p.price*82) <= max);
      if(sortSel.value === 'low') items.sort((a,b)=> a.price - b.price);
      if(sortSel.value === 'high') items.sort((a,b)=> b.price - a.price);
      return items;
    }

    function updateList(){ render(getFiltered()); }

    // attachHandlers after render
    function attachHandlers(){
      document.querySelectorAll('.productCard').forEach(el=> el.addEventListener('click', e=>{
        const id = Number(el.dataset.id);
        showModal(id);
      }));
      document.querySelectorAll('.addCart').forEach(b=> b.addEventListener('click', e=>{
        e.stopPropagation();
        addToCart(Number(e.currentTarget.dataset.id));
      }));
      document.querySelectorAll('.buyNow').forEach(b=> b.addEventListener('click', e=>{
        const id = Number(e.currentTarget.dataset.id);
        location.href = `payment.html?productId=${id}`;
      }));
    }

    // product modal
    const modalRoot = document.getElementById('modalRoot');
    function showModal(id){
      const p = PRODUCTS.find(x=> x.id === id);
      if(!p) return;
      const modal = document.createElement('div'); modal.className = 'modal-backdrop';
      modal.innerHTML = `
        <div class="bg-white rounded-xl w-full max-w-3xl p-6">
          <div class="flex gap-6">
            <div class="w-1/3 hidden sm:block"><img src="${p.img}" class="w-full h-48 object-cover rounded"></div>
            <div class="flex-1">
              <div class="flex justify-between items-start">
                <h3 class="text-lg font-bold">${p.title}</h3>
                <button id="closeModal" class="text-gray-600">✕</button>
              </div>
              <div class="text-sm text-gray-500 mt-1">${p.rating} ★ • ${p.category}</div>
              <div class="mt-3 text-gray-700">${p.description}</div>
              <div class="mt-4 font-semibold">${inr(p.price*82)}</div>
              <div class="mt-6 flex gap-3">
                <button id="modalAdd" class="px-4 py-2 bg-[#0ea5e9] text-white rounded">Add to cart</button>
                <a href="payment.html?productId=${p.id}" class="px-4 py-2 border rounded">Buy now</a>
              </div>
            </div>
          </div>
        </div>
      `;
      modalRoot.appendChild(modal);
      modal.querySelector('#closeModal').addEventListener('click', ()=> { modal.remove(); history.replaceState(null,'','products.html'); });
      modal.querySelector('#modalAdd').addEventListener('click', ()=> { addToCart(p.id); modal.remove(); });
      history.replaceState(null,'',`products.html?id=${p.id}`);
    }

    // CART (simplified)
    function readCart(){ return JSON.parse(localStorage.getItem('cart')||'[]'); }
    function writeCart(c){ localStorage.setItem('cart', JSON.stringify(c)); }

    function addToCart(id, qty=1){
      const cart = readCart();
      const it = cart.find(x=> x.productId === id);
      if(it) it.qty += qty; else cart.push({ productId:id, qty });
      writeCart(cart); alert('Added to cart'); // small feedback
    }

    // wire filters and search
    document.getElementById('cat').addEventListener('change', updateList);
    document.getElementById('sort').addEventListener('change', updateList);
    applyBtn.addEventListener('click', updateList);
    qInput.addEventListener('keydown', (e)=> { if(e.key === 'Enter'){ updateList(); } });

    // deep link handling
    const params = new URLSearchParams(location.search);
    const qParam = params.get('q');
    const catParam = params.get('cat');
    const idParam = params.get('id');
    if(qParam) { qInput.value = qParam; }
    if(catParam) { document.getElementById('cat').value = catParam; }
    updateList();
    if(idParam) showModal(Number(idParam));
  </script>
</body>
</html>
